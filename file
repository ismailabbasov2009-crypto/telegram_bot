import telebot
from telebot import types

# ----------------- –ù–ê–°–¢–†–û–ô–ö–ò -----------------
TOKEN = "8315056954:AAGA2P8OfhDj7E_TsX0HZr6B4sTq500tuMs"
ADMINS = [6331984658]           
CHAT_LINK = "https://t.me/Whitelinechatt" 
# --------------------------------------------

bot = telebot.TeleBot(TOKEN)
user_data = {}
complaints_admin = []
complaints_coworker = []

# ----------- –°–¢–ê–†–¢ –ò –ê–ù–ö–ï–¢–ê ----------------
@bot.message_handler(commands=['start'])
def start(message):
    user_id = message.from_user.id
    user_data[user_id] = {}
    
    # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
    markup.add("–ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É")
    markup.add("–ñ–∞–ª–æ–±—ã –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é")
    markup.add("–ñ–∞–ª–æ–±–∞ –Ω–∞ —Å–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞")
    bot.send_message(user_id, "üëã –ü—Ä–∏–≤–µ—Ç! –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup)
    user_data[user_id]["step"] = "menu"

@bot.message_handler(func=lambda m: True)
def handle_message(message):
    user_id = message.from_user.id
    text = message.text

    if user_id not in user_data:
        user_data[user_id] = {"step": "menu"}
    
    step = user_data[user_id].get("step", "menu")

    # --- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ---
    if step == "menu":
        if text == "–ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É":
            bot.send_message(user_id, "–ù–∞–ø–∏—à–∏ —Å–≤–æ—ë –∏–º—è:")
            user_data[user_id]["step"] = "name"
        elif text == "–ñ–∞–ª–æ–±—ã –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é":
            bot.send_message(user_id, "–ù–∞–ø–∏—à–∏ –∂–∞–ª–æ–±—É –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é:")
            user_data[user_id]["step"] = "complaint_admin"
        elif text == "–ñ–∞–ª–æ–±–∞ –Ω–∞ —Å–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞":
            bot.send_message(user_id, "–ù–∞–ø–∏—à–∏ –∂–∞–ª–æ–±—É –Ω–∞ —Å–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞:")
            user_data[user_id]["step"] = "complaint_coworker"
        else:
            bot.send_message(user_id, "–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–Ω–æ–ø–æ–∫ –Ω–∏–∂–µ üëá")
        return

    # --- –ê–Ω–∫–µ—Ç–∞ ---
    if step == "name":
        user_data[user_id]["name"] = text
        user_data[user_id]["step"] = "age"
        bot.send_message(user_id, "–û–∫–µ–π! –¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏ –≤–æ–∑—Ä–∞—Å—Ç:")
        return
    if step == "age":
        user_data[user_id]["age"] = text
        user_data[user_id]["step"] = "source"
        bot.send_message(user_id, "–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å: –∫–∞–∫ —Ç—ã —É–∑–Ω–∞–ª –æ –Ω–∞—Å?")
        return
    if step == "source":
        user_data[user_id]["source"] = text

        anketa = (
            f"üì© *–ù–æ–≤–∞—è –∞–Ω–∫–µ—Ç–∞*\n\n"
            f"üë§ –ò–º—è: {user_data[user_id]['name']}\n"
            f"üéÇ –í–æ–∑—Ä–∞—Å—Ç: {user_data[user_id]['age']}\n"
            f"‚ÑπÔ∏è –£–∑–Ω–∞–ª –æ –Ω–∞—Å: {user_data[user_id]['source']}\n"
            f"User ID: `{user_id}`"
        )

        # –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton("‚úÖ –ü—Ä–∏–Ω—è—Ç—å", callback_data=f"accept_{user_id}"))
        markup.add(types.InlineKeyboardButton("‚ùå –û—Ç–∫–∞–∑–∞—Ç—å", callback_data=f"deny_{user_id}"))

        for admin in ADMINS:
            bot.send_message(admin, anketa, parse_mode="Markdown", reply_markup=markup)

        bot.send_message(user_id, "–ê–Ω–∫–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É üëå")
        user_data[user_id]["step"] = "wait"
        return

    # --- –ñ–∞–ª–æ–±–∞ –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é ---
    if step == "complaint_admin":
        complaints_admin.append((user_id, text))
        for admin in ADMINS:
            bot.send_message(admin, f"üì¢ –ñ–∞–ª–æ–±–∞ –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é –æ—Ç {user_id}:\n{text}")
        bot.send_message(user_id, "–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –°–ø–∞—Å–∏–±–æ!")
        user_data[user_id]["step"] = "menu"
        start(message)
        return

    # --- –ñ–∞–ª–æ–±–∞ –Ω–∞ —Å–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞ ---
    if step == "complaint_coworker":
        complaints_coworker.append((user_id, text))
        for admin in ADMINS:
            bot.send_message(admin, f"üì¢ –ñ–∞–ª–æ–±–∞ –Ω–∞ —Å–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ—Ç {user_id}:\n{text}")
        bot.send_message(user_id, "–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –°–ø–∞—Å–∏–±–æ!")
        user_data[user_id]["step"] = "menu"
        start(message)
        return

# ----------- –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–û–ö –î–õ–Ø –ê–î–ú–ò–ù–ê -----------
@bot.callback_query_handler(func=lambda call: True)
def callback_query(call):
    if call.data.startswith("accept_"):
        uid = int(call.data.split("_")[1])
        bot.send_message(uid, f"üéâ –¢—ã –ø—Ä–∏–Ω—è—Ç! –í–æ—Ç —Å—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç:\n{CHAT_LINK}")
        bot.answer_callback_query(call.id, "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è—Ç ‚úÖ")
        call.message.edit_text("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è—Ç ‚úÖ")
    elif call.data.startswith("deny_"):
        uid = int(call.data.split("_")[1])
        bot.send_message(uid, "üòï –í –¥–æ—Å—Ç—É–ø–µ –æ—Ç–∫–∞–∑–∞–Ω–æ.")
        bot.answer_callback_query(call.id, "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω—ë–Ω ‚ùå")
        call.message.edit_text("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω—ë–Ω ‚ùå")

# ----------- –ó–ê–ü–£–°–ö –ë–û–¢–ê -----------
bot.polling(none_stop=True)

